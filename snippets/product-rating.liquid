{% comment %}
  Product Rating Snippet
  Displays star rating with accessibility support
  
  Parameters:
  - rating: number (0-5)
  - count: number of reviews
  - show_count: boolean (default: true)
{% endcomment %}

{%- liquid
  assign rating = rating | default: 0
  assign count = count | default: 0
  assign show_count = show_count | default: true
  assign rating_decimal = rating | modulo: 1
  assign rating_max = 5
-%}

{%- if rating > 0 -%}
  <div class="product-rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: rating, rating_max: rating_max }}">
    <div class="product-rating__stars">
      {%- for i in (1..rating_max) -%}
        {%- if i <= rating -%}
          <span class="product-rating__star product-rating__star--full" aria-hidden="true">★</span>
        {%- elsif i == rating | plus: 1 and rating_decimal > 0 -%}
          <span class="product-rating__star product-rating__star--half" aria-hidden="true">
            <span class="product-rating__star-half" style="width: {{ rating_decimal | times: 100 }}%">★</span>
            <span class="product-rating__star-empty">☆</span>
          </span>
        {%- else -%}
          <span class="product-rating__star product-rating__star--empty" aria-hidden="true">☆</span>
        {%- endif -%}
      {%- endfor -%}
    </div>
    
    {%- if show_count and count > 0 -%}
      <span class="product-rating__count">
        ({{ count }})
      </span>
    {%- endif -%}
    
    <span class="visually-hidden">
      {{ 'accessibility.star_reviews_info' | t: rating_value: rating, rating_max: rating_max }}
      {%- if count > 0 -%}
        {{ 'accessibility.total_reviews' | t: review_count: count }}
      {%- endif -%}
    </span>
  </div>
{%- endif -%}

{% stylesheet %}
.product-rating {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.product-rating__stars {
  display: flex;
  align-items: center;
  gap: 0.125rem;
}

.product-rating__star {
  font-size: 1rem;
  line-height: 1;
  position: relative;
}

.product-rating__star--full {
  color: #ffc107;
}

.product-rating__star--empty {
  color: rgba(var(--color-base-text), 0.2);
}

.product-rating__star--half {
  position: relative;
  color: rgba(var(--color-base-text), 0.2);
}

.product-rating__star-half {
  position: absolute;
  top: 0;
  left: 0;
  overflow: hidden;
  color: #ffc107;
}

.product-rating__star-empty {
  position: relative;
  z-index: 1;
}

.product-rating__count {
  font-size: 0.875rem;
  color: rgba(var(--color-base-text), 0.7);
  text-decoration: none;
}

.product-rating__count:hover {
  text-decoration: underline;
}

.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}
{% endstylesheet %}
