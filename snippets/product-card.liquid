{% comment %}
  Product Card Snippet
  Reusable product card component with best practices
  
  Parameters:
  - product: product object
  - show_vendor: boolean
  - show_rating: boolean  
  - show_quick_add: boolean
  - lazy_load: boolean (default: true)
{% endcomment %}

{%- liquid
  assign show_vendor = show_vendor | default: false
  assign show_rating = show_rating | default: true
  assign show_quick_add = show_quick_add | default: true
  assign lazy_load = lazy_load | default: true
  assign current_variant = product.selected_or_first_available_variant
-%}

<div class="product-card" data-product-id="{{ product.id }}">
  <div class="product-card__media">
    <a href="{{ product.url }}" class="product-card__link" aria-label="{{ product.title | escape }}">
      {%- if product.featured_media -%}
        <img
          src="{{ product.featured_media | image_url: width: 400 }}"
          alt="{{ product.featured_media.alt | escape }}"
          class="product-card__image{% if lazy_load %} lazy{% endif %}"
          width="400"
          height="400"
          loading="{% if lazy_load %}lazy{% else %}eager{% endif %}"
          {% if lazy_load %}data-src="{{ product.featured_media | image_url: width: 400 }}"{% endif %}
        >
        
        {%- if product.media.size > 1 -%}
          <img
            src="{{ product.media[1] | image_url: width: 400 }}"
            alt="{{ product.media[1].alt | escape }}"
            class="product-card__image product-card__image--hover{% if lazy_load %} lazy{% endif %}"
            width="400"
            height="400"
            loading="lazy"
            {% if lazy_load %}data-src="{{ product.media[1] | image_url: width: 400 }}"{% endif %}
          >
        {%- endif -%}
      {%- else -%}
        <div class="product-card__placeholder">
          {% render 'icon', name: 'placeholder' %}
        </div>
      {%- endif -%}
    </a>
    
    {%- if product.compare_at_price > product.price -%}
      <div class="product-card__badge product-card__badge--sale">
        {{ 'products.product.on_sale' | t }}
      </div>
    {%- endif -%}
    
    {%- unless current_variant.available -%}
      <div class="product-card__badge product-card__badge--sold-out">
        {{ 'products.product.sold_out' | t }}
      </div>
    {%- endunless -%}
    
    {%- if show_quick_add and current_variant.available -%}
      <button 
        class="product-card__quick-add btn btn--secondary"
        data-product-quick-add
        data-variant-id="{{ current_variant.id }}"
        aria-label="{{ 'products.product.quick_add' | t: product: product.title }}"
      >
        {% render 'icon', name: 'plus' %}
        {{ 'products.product.quick_add' | t }}
      </button>
    {%- endif -%}
  </div>
  
  <div class="product-card__content">
    {%- if show_vendor and product.vendor != blank -%}
      <div class="product-card__vendor">{{ product.vendor }}</div>
    {%- endif -%}
    
    <h3 class="product-card__title">
      <a href="{{ product.url }}" class="product-card__title-link">
        {{ product.title | escape }}
      </a>
    </h3>
    
    {%- if show_rating and product.metafields.reviews.rating.value != blank -%}
      <div class="product-card__rating">
        {% render 'product-rating', rating: product.metafields.reviews.rating.value, count: product.metafields.reviews.rating_count.value %}
      </div>
    {%- endif -%}
    
    <div class="product-card__price">
      <span class="price price--current">
        {{ current_variant.price | money }}
      </span>
      
      {%- if current_variant.compare_at_price > current_variant.price -%}
        <span class="price price--compare">
          {{ current_variant.compare_at_price | money }}
        </span>
        <span class="price-badge price-badge--sale">
          {{ current_variant.compare_at_price | minus: current_variant.price | times: 100 | divided_by: current_variant.compare_at_price }}% {{ 'products.product.off' | t }}
        </span>
      {%- endif -%}
    </div>
    
    {%- if product.variants.size > 1 -%}
      <div class="product-card__variants">
        <span class="product-card__variants-text">
          {{ 'products.product.variants_count' | t: count: product.variants.size }}
        </span>
      </div>
    {%- endif -%}
  </div>
</div>

{% stylesheet %}
.product-card {
  position: relative;
  background: rgb(var(--color-base-background-1));
  border-radius: var(--product-card-corner-radius);
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border: var(--product-card-border-width) solid rgba(var(--color-base-text), var(--product-card-border-opacity));
}

.product-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(var(--color-shadow), 0.15);
}

.product-card__media {
  position: relative;
  aspect-ratio: 1;
  overflow: hidden;
}

.product-card__link {
  display: block;
  width: 100%;
  height: 100%;
}

.product-card__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity 0.3s ease;
}

.product-card__image--hover {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
}

.product-card:hover .product-card__image--hover {
  opacity: 1;
}

.product-card__placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgb(var(--color-base-background-2));
  color: rgba(var(--color-base-text), 0.5);
}

.product-card__badge {
  position: absolute;
  top: 0.75rem;
  left: 0.75rem;
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: var(--badge-corner-radius);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.product-card__badge--sale {
  background: rgb(var(--color-base-accent-1));
  color: rgb(var(--color-base-solid-button-labels));
}

.product-card__badge--sold-out {
  background: rgba(var(--color-base-text), 0.8);
  color: rgb(var(--color-base-background-1));
}

.product-card__quick-add {
  position: absolute;
  bottom: 0.75rem;
  right: 0.75rem;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
}

.product-card:hover .product-card__quick-add {
  opacity: 1;
  transform: translateY(0);
}

.product-card__content {
  padding: 1rem;
  text-align: var(--product-card-text-alignment);
}

.product-card__vendor {
  font-size: 0.75rem;
  color: rgba(var(--color-base-text), 0.6);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.25rem;
}

.product-card__title {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
  font-weight: 500;
  line-height: 1.3;
}

.product-card__title-link {
  color: rgb(var(--color-base-text));
  text-decoration: none;
  transition: color 0.2s ease;
}

.product-card__title-link:hover {
  color: rgb(var(--color-base-accent-1));
}

.product-card__rating {
  margin-bottom: 0.5rem;
}

.product-card__price {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-bottom: 0.5rem;
}

.price {
  font-weight: 600;
}

.price--current {
  color: rgb(var(--color-base-text));
}

.price--compare {
  color: rgba(var(--color-base-text), 0.6);
  text-decoration: line-through;
  font-size: 0.875rem;
}

.price-badge {
  font-size: 0.75rem;
  padding: 0.125rem 0.375rem;
  border-radius: var(--badge-corner-radius);
}

.price-badge--sale {
  background: rgb(var(--color-base-accent-1));
  color: rgb(var(--color-base-solid-button-labels));
}

.product-card__variants {
  font-size: 0.875rem;
  color: rgba(var(--color-base-text), 0.7);
}

@media (max-width: 749px) {
  .product-card__quick-add {
    opacity: 1;
    transform: translateY(0);
    position: static;
    margin-top: 0.75rem;
    width: 100%;
    justify-content: center;
  }
}
{% endstylesheet %}
